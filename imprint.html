<!doctype html>
<html>
<head>
<style type='text/css'>
<script type="text/javascript">
canvas {
  border: 1px solid #aaa;
  cursor: none;
}
</style>
<script type="text/javascript" src="jquery-1.4.3.min.js"></script>
<script type="text/javascript" src="jshashtable-3.0.js"></script>
<script type="text/javascript">
var context;
var width = 500;
var height = 500;

function setBackground() {
	context.clearRect(0, 0, width, height);
	context.fillStyle = "black";
	context.fillRect(0,0,width,height);
}

function point(x,y) {
	this.x = x;
	this.y = y;
}

var mouse = new point(0,0);
var imprintables = new Hashtable();
var records = [];


function createImprintable(key, info) {
	var imprintHash = {"info" : info, "actions" : []};
	imprintables.put(key, imprintHash);
}

function createRecord(key, info, actions) {
	info["key"] = key;
	var recordHash = {"info" : info, "actions" : actions, "time_index": 0, "time_direction" : 1};
	records.push(recordHash);
	alert("record actions: " + records[0].actions);
}

function createRecordFromImprint(key) {
		var imprintedRecord = imprintables.get(key);
		createRecord(key, imprintedRecord["info"], imprintedRecord["actions"]);
		//imprintedRecord["actions"] = [];
}

function imprint(key, actions) {
	var imprintHash = imprintables.get(key);
	var imprintedActions = imprintHash["actions"];
	imprintedActions.push(actions)
}

var mouseInfo = {"category" : "painter"};
createImprintable("mouse", mouseInfo);
for (var i = 0; i < 10; i ++) {
	imprint("mouse", {"x" : i * 10, "y" : i * 10, "color" : "blue", "radius" : 50});
}

alert("actions" + imprintables.get("mouse")["actions"]);

createRecordFromImprint("mouse");
alert(records[0]["actions"].length);
alert(imprintables.get("mouse")["actions"]);

function playbackRecords() {
	for (var i = 0; i < records.length; i++) {
		var recordHash = records[i];
		console.log(recordHash);
		playbackRecordedImprint(recordHash["info"], recordHash["actions"][recordHash["time_index"]], recordHash["time_index"], recordHash["time_direction"]);
		recordHash["time_index"] = recordHash["time_index"] + recordHash["time_direction"];
		if (recordHash["time_index"] > recordHash["actions"].length - 1) {
			recordHash["time_index"] = recordHash["actions"].length - 1;
			recordHash["time_direction"] = -1;
		} else if (recordHash["time_index"] < 0) {
			recordHash["time_index"] = 0
			recordHash["time_direction"] = 1;
		}
	}
}

function playbackRecordedImprint(info, actions, time_index, time_direction) {
	if (info["category"] === "painter") {
		drawCircle({"x" : 50, "y" : 50}, "blue", 50);
		doPaintingActions(actions);
	}	
}

function doPaintingActions(actions) {
	drawCircle({"x" : actions["x"], "y" : actions["x"]}, actions["color"], actions["radius"]);
}

function drawCircle(p,colour,radius) {
	context.fillStyle = colour;
	context.beginPath();
	context.arc(p.x,p.y,radius,0,Math.PI*2,true);
	context.closePath();
	context.fill();
}

function showPlayer() {
	drawCircle(mouse, "blue", 10);
}

function showClones() {
  for (var i = 0; i < clones.length; i++) {
  	var c = cats[i];
  	drawCircle(c, "green", 5);
  }
}

var index = 0;

function draw() {
	setBackground();
	playbackRecords();
	//showMouse();
	// var data = {"x" : mouse.x, "y" : mouse.y}
	// record(mouse, data);
	// var points = records.get(mouse);
	// console.log(points[index]);
	// index++;
}

$(document).ready(function() {
  var canvas = $('#canvas');	
  context = canvas.get(0).getContext('2d');
  
  setInterval(draw, 10);
  canvas.mousemove(function(e) {
    var mousex = e.pageX - canvas.offset().left;
    var mousey = e.pageY - canvas.offset().top;

		mouse.x = mousex;
		mouse.y = mousey;		
  }); 

});

</script>
</head>
<body>
<canvas id='canvas' width=500 height=500></canvas>
</body>
</html>